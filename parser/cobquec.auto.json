{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "$defs": {
        "partOf": {
            "$ref": "#/$defs/label"
        },
        "operator": {
            "type": "string",
            "pattern": "(\\+|-|/|\\*)"
        },
        "operandLeft": {
            "anyOf": [
                {
                    "required": [
                        "function"
                    ]
                },
                {
                    "required": [
                        "operation"
                    ]
                },
                {
                    "type": "string",
                    "pattern": "(-?[1-9]*[0-9]\\.[0-9]+|[1-9]*[0-9]|-[1-9]*[0-9])"
                }
            ],
            "properties": {
                "function": {
                    "$ref": "#/$defs/function"
                },
                "operation": {
                    "$ref": "#/$defs/operation"
                }
            },
            "type": [
                "string",
                "object"
            ]
        },
        "operandRight": {
            "anyOf": [
                {
                    "required": [
                        "function"
                    ]
                },
                {
                    "required": [
                        "operation"
                    ]
                },
                {
                    "type": "string",
                    "pattern": "(-?[1-9]*[0-9]\\.[0-9]+|[1-9]*[0-9]|-[1-9]*[0-9])"
                }
            ],
            "properties": {
                "function": {
                    "$ref": "#/$defs/function"
                },
                "operation": {
                    "$ref": "#/$defs/operation"
                }
            },
            "type": [
                "string",
                "object"
            ]
        },
        "operation": {
            "type": "object",
            "properties": {
                "operandLeft": {
                    "$ref": "#/$defs/operandLeft"
                },
                "operator": {
                    "$ref": "#/$defs/operator"
                },
                "operandRight": {
                    "$ref": "#/$defs/operandRight"
                }
            },
            "required": [
                "operandLeft",
                "operator",
                "operandRight"
            ]
        },
        "math": {
            "anyOf": [
                {
                    "required": [
                        "function"
                    ]
                },
                {
                    "required": [
                        "operation"
                    ]
                },
                {
                    "type": "string",
                    "pattern": "(-?[1-9]*[0-9]\\.[0-9]+|[1-9]*[0-9]|-[1-9]*[0-9])"
                }
            ],
            "properties": {
                "function": {
                    "$ref": "#/$defs/function"
                },
                "operation": {
                    "$ref": "#/$defs/operation"
                }
            },
            "type": [
                "string",
                "object"
            ]
        },
        "min": {
            "type": [
                "string",
                "number"
            ],
            "pattern": "[1-9]*[0-9]"
        },
        "max": {
            "type": [
                "string",
                "number"
            ],
            "pattern": "([1-9]*[0-9]|\\*)"
        },
        "repetition": {
            "type": "object",
            "properties": {
                "min": {
                    "$ref": "#/$defs/min"
                },
                "max": {
                    "$ref": "#/$defs/max"
                }
            },
            "required": [
                "min",
                "max"
            ]
        },
        "leftSpan": {
            "type": [
                "string",
                "number"
            ],
            "pattern": "-[1-9]*[0-9]"
        },
        "rightSpan": {
            "type": [
                "string",
                "number"
            ],
            "pattern": "[1-9]*[0-9]"
        },
        "window": {
            "type": "object",
            "properties": {
                "leftSpan": {
                    "$ref": "#/$defs/leftSpan"
                },
                "rightSpan": {
                    "$ref": "#/$defs/rightSpan"
                }
            },
            "required": [
                "leftSpan",
                "rightSpan"
            ]
        },
        "quantifier": {
            "type": "string",
            "pattern": "(((~|\u00ac|!|not )?EXISTS)|(ALL(~|\u00ac|!|not )?))"
        },
        "quantification": {
            "type": "object",
            "properties": {
                "quantifier": {
                    "$ref": "#/$defs/quantifier"
                },
                "unit": {
                    "$ref": "#/$defs/unit"
                },
                "sequence": {
                    "$ref": "#/$defs/sequence"
                },
                "set": {
                    "$ref": "#/$defs/set"
                }
            },
            "anyOf": [
                {
                    "required": [
                        "unit"
                    ]
                },
                {
                    "required": [
                        "sequence"
                    ]
                },
                {
                    "required": [
                        "set"
                    ]
                }
            ],
            "required": [
                "quantifier"
            ]
        },
        "arguments": {
            "type": "array",
            "items": {
                "anyOf": [
                    {
                        "required": [
                            "label"
                        ]
                    },
                    {
                        "required": [
                            "function"
                        ]
                    },
                    {
                        "required": [
                            "attribute"
                        ]
                    },
                    {
                        "required": [
                            "string"
                        ]
                    },
                    {
                        "required": [
                            "regex"
                        ]
                    },
                    {
                        "required": [
                            "math"
                        ]
                    }
                ],
                "properties": {
                    "label": {
                        "$ref": "#/$defs/label"
                    },
                    "function": {
                        "$ref": "#/$defs/function"
                    },
                    "attribute": {
                        "$ref": "#/$defs/attribute"
                    },
                    "string": {
                        "$ref": "#/$defs/string"
                    },
                    "regex": {
                        "$ref": "#/$defs/regex"
                    },
                    "math": {
                        "$ref": "#/$defs/math"
                    }
                },
                "type": "object"
            },
            "minItems": 1
        },
        "functionName": {
            "type": "string",
            "pattern": "(length|size|range|position|start|end|century|date|year|day)"
        },
        "function": {
            "type": "object",
            "properties": {
                "functionName": {
                    "$ref": "#/$defs/functionName"
                },
                "arguments": {
                    "$ref": "#/$defs/arguments"
                }
            },
            "required": [
                "functionName",
                "arguments"
            ]
        },
        "regex": {
            "type": "string",
            "pattern": "\\/.+\\/"
        },
        "string": {
            "type": "string",
            "pattern": "\"[^\"\\n]*\""
        },
        "attribute": {
            "type": "string",
            "pattern": "[a-z][a-zA-Z0-9_]*(\\.([a-zA-Z0-9_]+))+"
        },
        "label": {
            "type": "string",
            "pattern": "([a-z][a-zA-Z0-9_]*|(frequency|minimum|maximum|average|stddev))"
        },
        "layer": {
            "type": "string",
            "pattern": "[A-Z][a-zA-Z0-9_]+"
        },
        "labelOrAttribute": {
            "type": "string",
            "pattern": "([a-z][a-zA-Z0-9_]*|(frequency|minimum|maximum|average|stddev)|[a-z][a-zA-Z0-9_]*(\\.([a-zA-Z0-9_]+))+)"
        },
        "left": {
            "anyOf": [
                {
                    "required": [
                        "function"
                    ]
                },
                {
                    "required": [
                        "label"
                    ]
                },
                {
                    "required": [
                        "attribute"
                    ]
                },
                {
                    "required": [
                        "string"
                    ]
                },
                {
                    "required": [
                        "regex"
                    ]
                },
                {
                    "required": [
                        "math"
                    ]
                }
            ],
            "properties": {
                "function": {
                    "$ref": "#/$defs/function"
                },
                "label": {
                    "$ref": "#/$defs/label"
                },
                "attribute": {
                    "$ref": "#/$defs/attribute"
                },
                "string": {
                    "$ref": "#/$defs/string"
                },
                "regex": {
                    "$ref": "#/$defs/regex"
                },
                "math": {
                    "$ref": "#/$defs/math"
                }
            },
            "type": "object"
        },
        "right": {
            "anyOf": [
                {
                    "required": [
                        "function"
                    ]
                },
                {
                    "required": [
                        "label"
                    ]
                },
                {
                    "required": [
                        "attribute"
                    ]
                },
                {
                    "required": [
                        "string"
                    ]
                },
                {
                    "required": [
                        "regex"
                    ]
                },
                {
                    "required": [
                        "math"
                    ]
                }
            ],
            "properties": {
                "function": {
                    "$ref": "#/$defs/function"
                },
                "label": {
                    "$ref": "#/$defs/label"
                },
                "attribute": {
                    "$ref": "#/$defs/attribute"
                },
                "string": {
                    "$ref": "#/$defs/string"
                },
                "regex": {
                    "$ref": "#/$defs/regex"
                },
                "math": {
                    "$ref": "#/$defs/math"
                }
            },
            "type": "object"
        },
        "comparator": {
            "type": "string",
            "pattern": "((~|\u00ac|!|not )?(=|[><]=?|contain))"
        },
        "comparison": {
            "type": "object",
            "properties": {
                "left": {
                    "$ref": "#/$defs/left"
                },
                "comparator": {
                    "$ref": "#/$defs/comparator"
                },
                "right": {
                    "$ref": "#/$defs/right"
                }
            },
            "required": [
                "left",
                "comparator",
                "right"
            ]
        },
        "unaryOperator": {
            "type": "string",
            "pattern": "(~|\u00ac|!|not )"
        },
        "naryOperator": {
            "type": "string",
            "pattern": "(AND|OR)"
        },
        "logicalExpression": {
            "anyOf": [
                {
                    "type": "object",
                    "properties": {
                        "unaryOperator": {
                            "$ref": "#/$defs/unaryOperator"
                        },
                        "constraint": {
                            "$ref": "#/$defs/constraint"
                        }
                    },
                    "required": [
                        "unaryOperator",
                        "constraint"
                    ]
                },
                {
                    "type": "object",
                    "properties": {
                        "naryOperator": {
                            "$ref": "#/$defs/naryOperator"
                        },
                        "constraints": {
                            "$ref": "#/$defs/constraints"
                        }
                    },
                    "required": [
                        "naryOperator",
                        "constraints"
                    ]
                }
            ],
            "type": "object"
        },
        "unit": {
            "type": "object",
            "properties": {
                "layer": {
                    "$ref": "#/$defs/layer"
                },
                "partOf": {
                    "$ref": "#/$defs/partOf"
                },
                "label": {
                    "$ref": "#/$defs/label"
                },
                "constraints": {
                    "$ref": "#/$defs/constraints"
                }
            },
            "required": [
                "layer"
            ]
        },
        "constraint": {
            "anyOf": [
                {
                    "required": [
                        "quantification"
                    ]
                },
                {
                    "required": [
                        "unit"
                    ]
                },
                {
                    "required": [
                        "logicalExpression"
                    ]
                },
                {
                    "required": [
                        "comparison"
                    ]
                }
            ],
            "properties": {
                "quantification": {
                    "$ref": "#/$defs/quantification"
                },
                "unit": {
                    "$ref": "#/$defs/unit"
                },
                "logicalExpression": {
                    "$ref": "#/$defs/logicalExpression"
                },
                "comparison": {
                    "$ref": "#/$defs/comparison"
                }
            },
            "type": "object"
        },
        "constraints": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/constraint"
            },
            "minItems": 1
        },
        "members": {
            "type": "array",
            "items": {
                "anyOf": [
                    {
                        "required": [
                            "unit"
                        ]
                    },
                    {
                        "required": [
                            "sequence"
                        ]
                    }
                ],
                "properties": {
                    "unit": {
                        "$ref": "#/$defs/unit"
                    },
                    "sequence": {
                        "$ref": "#/$defs/sequence"
                    }
                },
                "type": "object"
            },
            "minItems": 1
        },
        "set": {
            "type": "object",
            "properties": {
                "partOf": {
                    "$ref": "#/$defs/partOf"
                },
                "label": {
                    "$ref": "#/$defs/label"
                },
                "members": {
                    "$ref": "#/$defs/members"
                }
            },
            "required": [
                "members"
            ]
        },
        "sequence": {
            "type": "object",
            "properties": {
                "partOf": {
                    "$ref": "#/$defs/partOf"
                },
                "label": {
                    "$ref": "#/$defs/label"
                },
                "repetition": {
                    "$ref": "#/$defs/repetition"
                },
                "members": {
                    "$ref": "#/$defs/members"
                }
            },
            "required": [
                "members"
            ]
        },
        "result": {
            "type": "object",
            "properties": {
                "label": {
                    "$ref": "#/$defs/label"
                },
                "resultsPlain": {
                    "$ref": "#/$defs/resultsPlain"
                },
                "resultsAnalysis": {
                    "$ref": "#/$defs/resultsAnalysis"
                },
                "resultsCollocation": {
                    "$ref": "#/$defs/resultsCollocation"
                }
            },
            "anyOf": [
                {
                    "required": [
                        "resultsPlain"
                    ]
                },
                {
                    "required": [
                        "resultsAnalysis"
                    ]
                },
                {
                    "required": [
                        "resultsCollocation"
                    ]
                }
            ],
            "required": [
                "label"
            ]
        },
        "results": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/result"
            },
            "minItems": 1
        },
        "resultsPlain": {
            "type": "object",
            "properties": {
                "context": {
                    "$ref": "#/$defs/resultsPlainContext"
                },
                "entities": {
                    "$ref": "#/$defs/resultsPlainEntities"
                }
            },
            "required": [
                "context",
                "entities"
            ]
        },
        "resultsPlainContext": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/label"
            },
            "minItems": 1
        },
        "resultsPlainEntities": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/label"
            },
            "minItems": 1
        },
        "resultsAnalysis": {
            "type": "object",
            "properties": {
                "attributes": {
                    "$ref": "#/$defs/resultsAnalysisAttributes"
                },
                "functions": {
                    "$ref": "#/$defs/resultsAnalysisFunctions"
                },
                "filter": {
                    "$ref": "#/$defs/resultsAnalysisFilter"
                }
            },
            "required": [
                "attributes",
                "functions"
            ]
        },
        "resultsAnalysisAttributes": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/labelOrAttribute"
            },
            "minItems": 1
        },
        "resultsAnalysisFunctions": {
            "type": "array",
            "items": {
                "type": "string",
                "pattern": "(frequency|minimum|maximum|average|stddev)"
            },
            "minItems": 1
        },
        "resultsAnalysisFilter": {
            "type": "array",
            "items": {
                "anyOf": [
                    {
                        "required": [
                            "comparison"
                        ]
                    },
                    {
                        "required": [
                            "comparison"
                        ]
                    }
                ],
                "properties": {
                    "comparison": {
                        "$ref": "#/$defs/comparison"
                    }
                },
                "type": "object"
            },
            "minItems": 1
        },
        "resultsCollocation": {
            "type": "object",
            "properties": {
                "center": {
                    "$ref": "#/$defs/resultsCollocationCenter"
                },
                "space": {
                    "$ref": "#/$defs/resultsCollocationSpace"
                },
                "attribute": {
                    "$ref": "#/$defs/resultsCollocationAttribute"
                }
            },
            "anyOf": [
                {
                    "required": [
                        "center"
                    ]
                },
                {
                    "required": [
                        "space"
                    ]
                }
            ],
            "required": [
                "attribute"
            ]
        },
        "resultsCollocationSpace": {
            "$ref": "#/$defs/label"
        },
        "resultsCollocationCenter": {
            "type": "object",
            "properties": {
                "label": {
                    "$ref": "#/$defs/label"
                },
                "window": {
                    "$ref": "#/$defs/window"
                }
            },
            "required": [
                "label",
                "window"
            ]
        },
        "resultsCollocationAttribute": {
            "anyOf": [
                {
                    "required": [
                        "attribute"
                    ]
                },
                {
                    "required": [
                        "label"
                    ]
                }
            ],
            "properties": {
                "attribute": {
                    "$ref": "#/$defs/attribute"
                },
                "label": {
                    "$ref": "#/$defs/label"
                }
            },
            "type": "object"
        },
        "query": {
            "type": "array",
            "items": {
                "anyOf": [
                    {
                        "required": [
                            "quantification"
                        ]
                    },
                    {
                        "required": [
                            "sequence"
                        ]
                    },
                    {
                        "required": [
                            "set"
                        ]
                    },
                    {
                        "required": [
                            "unit"
                        ]
                    },
                    {
                        "required": [
                            "constraint"
                        ]
                    }
                ],
                "properties": {
                    "quantification": {
                        "$ref": "#/$defs/quantification"
                    },
                    "sequence": {
                        "$ref": "#/$defs/sequence"
                    },
                    "set": {
                        "$ref": "#/$defs/set"
                    },
                    "unit": {
                        "$ref": "#/$defs/unit"
                    },
                    "constraint": {
                        "$ref": "#/$defs/constraint"
                    }
                },
                "type": "object"
            },
            "minItems": 1
        }
    },
    "type": "object",
    "properties": {
        "query": {
            "$ref": "#/$defs/query"
        },
        "results": {
            "$ref": "#/$defs/results"
        }
    },
    "required": [
        "query",
        "results"
    ],
    "skips": {
        "operandLeft": [
            "math"
        ],
        "operandRight": [
            "math"
        ],
        "constraints": [
            "constraint"
        ],
        "results": [
            "result"
        ],
        "resultsPlainContext": [
            "label"
        ],
        "resultsPlainEntities": [
            "label"
        ],
        "resultsAnalysisAttributes": [
            "labelOrAttribute"
        ]
    },
    "renames": {
        "resultsPlain": {
            "resultsPlainContext": "context",
            "resultsPlainEntities": "entities"
        },
        "resultsAnalysis": {
            "resultsAnalysisAttributes": "attributes",
            "resultsAnalysisFunctions": "functions",
            "resultsAnalysisFilter": "filter"
        },
        "resultsCollocation": {
            "resultsCollocationSpace": "space",
            "resultsCollocationAttribute": "attribute",
            "resultsCollocationCenter": "center"
        }
    }
}